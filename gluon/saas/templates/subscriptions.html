{% extends "master.html" %}

{% block javascript %}
    <script type="application/javascript">
        $(document).ready(function() {
            function AddAjaxContent(url){
                $(".preloader").show();
                $.ajax({
                    mimeType: "text/html; charset=utf-8",
                    url: url,
                    type: "GET",
                    success: function(data) {
                        $("#ajax-content").html(data+$("#ajax-content").html());
                        $(".preloader").hide();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown);
                    },
                    dataType: "html",
                    async: false
                });
            }

            var data_table = $(".datatable").dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "{% url "subscriptions_json" %}",
                "stateSave": true,
                "language": {
                    "sLengthMenu": "Display _MENU_ subscription by page",
                    "sZeroRecords": "There is any subscription yet",
                    "sInfo": "Displaying subscriptions _START_ to _END_ on _TOTAL_",
                    "sInfoEmpty": "No subscriptions to display",
                    "sInfoFiltered": "(without any filter, there is actually _MAX_ subscription)",
                    "sSearch": "Search filter",
                },
                "columnDefs": [
                    {
                        "targets": [ 0 ],
                        "visible": false,
                        "searchable": false,
                    },
                    {
                        "targets": [ 1, 2, 4 ],
                        "visible": true,
                        "searchable": true,
                    },
                    {
                        "targets": [ 3 ],
                        "visible": true,
                        "searchable": false,
                    },
                ],
                "createdRow": function ( row, data, index ) {
                    if ( data[3] == "Yes" ) {
                        $('td', row).eq(2).html('<button type="button" class="btn btn-success"><i class="fa fa-check-square-o"> Open</button>'); // Column 1 hidden, so data 3 match column 2
                    } else {
                        $('td', row).eq(2).html('<button type="button" class="btn btn-danger"><i class="fa fa-square-o"> Closed</button>'); // Column 1 hidden
                    }
                },
            });

            $(".datatable tbody").on("click", "tr", function () {
                var name = $("td", this).eq(0).text();
                var id = data_table.fnGetData(this)[0];
                var url = "/subscriptions/view/" + id;
                window.location.hash = url;
                if ($(this).hasClass("selected")) {
                    $("#detail_" + id + " .close-link").trigger("click");
                } else {
                    AddAjaxContent(url);
                }
                $(this).toggleClass("selected");
            });

            $(".preloader").hide();
        });
    </script>
{% endblock %}

{% block content %}

    <div class="box">
        <div class="box-header">
            <div class="box-name ui-draggable-handle">
                <i class="fa fa-search"></i>
                <span>List</span>
            </div>
            <div class="box-icons">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
                <a class="expand-link">
                    <i class="fa fa-expand"></i>
                </a>
            </div>
            <div class="no-move"></div>
        </div>
        <div class="box-content">
            <div id="list-content">
                <table id="list" class="datatable table table-striped table-bordered table-hover table-heading  table-datatable dataTable" width="100%">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Label</th>
                            <th>Owner</th>
                            <th>Still Open ?</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

{% endblock %}
